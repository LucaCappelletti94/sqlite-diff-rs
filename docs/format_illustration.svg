<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 380" width="720" height="380">
  <defs>
    <marker id="arrow-green" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="7" markerHeight="5" orient="auto">
      <polygon points="0,0 10,3.5 0,7" fill="#2e7d32"/>
    </marker>
    <marker id="arrow-red" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="7" markerHeight="5" orient="auto">
      <polygon points="0,0 10,3.5 0,7" fill="#c62828"/>
    </marker>
    <marker id="arrow-orange" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="7" markerHeight="5" orient="auto">
      <polygon points="0,0 10,3.5 0,7" fill="#e65100"/>
    </marker>
    <clipPath id="clip-left">
      <rect x="12" y="48" width="318" height="270" rx="8"/>
    </clipPath>
    <clipPath id="clip-right">
      <rect x="390" y="48" width="318" height="270" rx="8"/>
    </clipPath>
  </defs>
  <style>
    text { font-family: system-ui, -apple-system, 'Segoe UI', Helvetica, Arial, sans-serif; }
    .mono { font-family: 'SF Mono', 'JetBrains Mono', 'Fira Code', Consolas, monospace; font-size: 7.5px; }
    .label { font-size: 8px; }
    .section-title { font-size: 9px; font-weight: 600; }
    .panel-title { font-size: 11px; font-weight: 700; letter-spacing: 0.5px; }
    .marker-text { font-size: 8px; opacity: 0.7; }
  </style>

  <!-- Background -->
  <rect width="720" height="380" fill="#fafafa"/>

  <!-- Title -->
  <text x="360" y="22" text-anchor="middle" font-size="14" font-weight="700" fill="#212121">SQLite Session Extension Binary Formats</text>
  <text x="360" y="38" text-anchor="middle" font-size="9" fill="#757575">Changeset vs Patchset wire layout</text>

  <!-- ===================== LEFT PANEL: CHANGESET ===================== -->
  <g>
    <!-- Panel background -->
    <rect x="12" y="48" width="318" height="270" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.2"/>

    <!-- Header bar -->
    <rect x="12" y="48" width="318" height="28" rx="8" fill="#1976d2" clip-path="url(#clip-left)"/>
    <rect x="12" y="68" width="318" height="8" fill="#1976d2"/>

    <text x="171" y="66" text-anchor="middle" class="panel-title" fill="#fff">CHANGESET</text>
    <text x="280" y="66" text-anchor="middle" class="marker-text" fill="#bbdefb">'T' = 0x54</text>

    <!-- Table Header Section -->
    <text x="20" y="92" class="section-title" fill="#1565c0">Table Header</text>
    <g transform="translate(20, 98)">
      <rect width="44" height="22" rx="3" fill="#bbdefb" stroke="#1976d2" stroke-width="0.8"/>
      <text x="22" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#0d47a1">'T'</text>

      <rect x="48" width="44" height="22" rx="3" fill="#bbdefb" stroke="#1976d2" stroke-width="0.8"/>
      <text x="70" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#0d47a1">nCol</text>

      <rect x="96" width="70" height="22" rx="3" fill="#bbdefb" stroke="#1976d2" stroke-width="0.8"/>
      <text x="131" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#0d47a1">pk_flags[]</text>

      <rect x="170" width="132" height="22" rx="3" fill="#bbdefb" stroke="#1976d2" stroke-width="0.8"/>
      <text x="236" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#0d47a1">table_name\0</text>
    </g>

    <!-- INSERT -->
    <text x="20" y="140" class="section-title" fill="#2e7d32">INSERT</text>
    <text x="62" y="140" class="label" fill="#66bb6a">0x12</text>
    <g transform="translate(20, 146)">
      <rect width="32" height="20" rx="3" fill="#a5d6a7" stroke="#43a047" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">0x12</text>

      <rect x="36" width="32" height="20" rx="3" fill="#a5d6a7" stroke="#43a047" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">0x00</text>

      <rect x="72" width="230" height="20" rx="3" fill="#c8e6c9" stroke="#43a047" stroke-width="0.8"/>
      <text x="187" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#1b5e20">new_val[0..N-1] — <tspan font-weight="600">ALL columns</tspan></text>
    </g>

    <!-- DELETE -->
    <text x="20" y="186" class="section-title" fill="#c62828">DELETE</text>
    <text x="62" y="186" class="label" fill="#ef5350">0x09</text>
    <g transform="translate(20, 192)">
      <rect width="32" height="20" rx="3" fill="#ef9a9a" stroke="#e53935" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#b71c1c">0x09</text>

      <rect x="36" width="32" height="20" rx="3" fill="#ef9a9a" stroke="#e53935" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#b71c1c">0x00</text>

      <rect x="72" width="230" height="20" rx="3" fill="#ffcdd2" stroke="#e53935" stroke-width="0.8"/>
      <text x="187" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#b71c1c">old_val[0..N-1] — <tspan font-weight="600">ALL columns</tspan></text>
    </g>

    <!-- UPDATE -->
    <text x="20" y="232" class="section-title" fill="#e65100">UPDATE</text>
    <text x="62" y="232" class="label" fill="#ff9800">0x17</text>
    <g transform="translate(20, 238)">
      <rect width="32" height="20" rx="3" fill="#ffe082" stroke="#ffa000" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#e65100">0x17</text>

      <rect x="36" width="32" height="20" rx="3" fill="#ffe082" stroke="#ffa000" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#e65100">0x00</text>

      <rect x="72" width="112" height="20" rx="3" fill="#fff8e1" stroke="#ffa000" stroke-width="0.8"/>
      <text x="128" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#e65100">old[0..N] <tspan font-weight="600">ALL</tspan></text>

      <rect x="188" width="114" height="20" rx="3" fill="#fff3e0" stroke="#ffa000" stroke-width="0.8"/>
      <text x="245" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#e65100">new[0..N] <tspan font-weight="600">ALL</tspan></text>
    </g>

    <!-- Footer -->
    <text x="171" y="290" text-anchor="middle" font-size="8" font-style="italic" fill="#5c6bc0">Reversible: full old state enables undo</text>
  </g>

  <!-- ===================== RIGHT PANEL: PATCHSET ===================== -->
  <g>
    <!-- Panel background -->
    <rect x="390" y="48" width="318" height="270" rx="8" fill="#e8f5e9" stroke="#388e3c" stroke-width="1.2"/>

    <!-- Header bar -->
    <rect x="390" y="48" width="318" height="28" rx="8" fill="#388e3c" clip-path="url(#clip-right)"/>
    <rect x="390" y="68" width="318" height="8" fill="#388e3c"/>

    <text x="549" y="66" text-anchor="middle" class="panel-title" fill="#fff">PATCHSET</text>
    <text x="658" y="66" text-anchor="middle" class="marker-text" fill="#a5d6a7">'P' = 0x50</text>

    <!-- Table Header Section -->
    <text x="398" y="92" class="section-title" fill="#2e7d32">Table Header</text>
    <g transform="translate(398, 98)">
      <rect width="44" height="22" rx="3" fill="#a5d6a7" stroke="#388e3c" stroke-width="0.8"/>
      <text x="22" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">'P'</text>

      <rect x="48" width="44" height="22" rx="3" fill="#a5d6a7" stroke="#388e3c" stroke-width="0.8"/>
      <text x="70" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">nCol</text>

      <rect x="96" width="70" height="22" rx="3" fill="#a5d6a7" stroke="#388e3c" stroke-width="0.8"/>
      <text x="131" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">pk_flags[]</text>

      <rect x="170" width="132" height="22" rx="3" fill="#a5d6a7" stroke="#388e3c" stroke-width="0.8"/>
      <text x="236" y="11" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">table_name\0</text>
    </g>

    <!-- INSERT (same) -->
    <text x="398" y="140" class="section-title" fill="#2e7d32">INSERT</text>
    <text x="440" y="140" class="label" fill="#66bb6a">0x12 — same</text>
    <g transform="translate(398, 146)">
      <rect width="32" height="20" rx="3" fill="#a5d6a7" stroke="#43a047" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">0x12</text>

      <rect x="36" width="32" height="20" rx="3" fill="#a5d6a7" stroke="#43a047" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#1b5e20">0x00</text>

      <rect x="72" width="230" height="20" rx="3" fill="#c8e6c9" stroke="#43a047" stroke-width="0.8"/>
      <text x="187" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#1b5e20">new_val[0..N-1] — <tspan font-weight="600">ALL columns</tspan></text>
    </g>

    <!-- DELETE (PK only) -->
    <text x="398" y="186" class="section-title" fill="#c62828">DELETE</text>
    <text x="443" y="186" class="label" fill="#ef5350">0x09 — <tspan font-weight="600">PK only</tspan></text>
    <g transform="translate(398, 192)">
      <rect width="32" height="20" rx="3" fill="#ef9a9a" stroke="#e53935" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#b71c1c">0x09</text>

      <rect x="36" width="32" height="20" rx="3" fill="#ef9a9a" stroke="#e53935" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#b71c1c">0x00</text>

      <rect x="72" width="150" height="20" rx="3" fill="#ffcdd2" stroke="#e53935" stroke-width="0.8"/>
      <text x="147" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#b71c1c">pk_val[] — <tspan font-weight="600">PK only</tspan></text>

      <rect x="226" width="76" height="20" rx="3" fill="#fce4ec" stroke="#e57373" stroke-width="0.8" stroke-dasharray="3 2"/>
      <text x="264" y="10" text-anchor="middle" dominant-baseline="central" class="label" font-style="italic" fill="#e57373">omitted</text>
    </g>

    <!-- UPDATE (sparse) -->
    <text x="398" y="232" class="section-title" fill="#e65100">UPDATE</text>
    <text x="445" y="232" class="label" fill="#ff9800">0x17 — <tspan font-weight="600">sparse</tspan></text>
    <g transform="translate(398, 238)">
      <rect width="32" height="20" rx="3" fill="#ffe082" stroke="#ffa000" stroke-width="0.8"/>
      <text x="16" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#e65100">0x17</text>

      <rect x="36" width="32" height="20" rx="3" fill="#ffe082" stroke="#ffa000" stroke-width="0.8"/>
      <text x="52" y="10" text-anchor="middle" dominant-baseline="central" class="mono" fill="#e65100">0x00</text>

      <rect x="72" width="112" height="20" rx="3" fill="#fff8e1" stroke="#ffa000" stroke-width="0.8"/>
      <text x="128" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#e65100">PK + <tspan class="mono">0x00</tspan></text>

      <rect x="188" width="114" height="20" rx="3" fill="#fff3e0" stroke="#ffa000" stroke-width="0.8"/>
      <text x="245" y="10" text-anchor="middle" dominant-baseline="central" class="label" fill="#e65100">changed + <tspan class="mono">0x00</tspan></text>
    </g>

    <!-- Footer -->
    <text x="549" y="290" text-anchor="middle" font-size="8" font-style="italic" fill="#66bb6a">Compact: minimal data, forward-only</text>
  </g>

  <!-- ===================== CENTER ARROWS ===================== -->
  <g transform="translate(340, 0)">
    <!-- INSERT arrow -->
    <line x1="0" y1="156" x2="38" y2="156" stroke="#2e7d32" stroke-width="1.2" stroke-dasharray="2 2" marker-end="url(#arrow-green)"/>
    <text x="19" y="148" text-anchor="middle" font-size="7" font-weight="600" fill="#2e7d32">same</text>

    <!-- DELETE arrow -->
    <line x1="0" y1="202" x2="38" y2="202" stroke="#c62828" stroke-width="1.2" stroke-dasharray="4 2" marker-end="url(#arrow-red)"/>
    <text x="19" y="194" text-anchor="middle" font-size="7" font-weight="600" fill="#c62828">PK only</text>

    <!-- UPDATE arrow -->
    <line x1="0" y1="248" x2="38" y2="248" stroke="#e65100" stroke-width="1.2" stroke-dasharray="4 2" marker-end="url(#arrow-orange)"/>
    <text x="19" y="240" text-anchor="middle" font-size="7" font-weight="600" fill="#e65100">sparse</text>
  </g>

  <!-- ===================== BOTTOM LEGEND ===================== -->
  <rect x="12" y="328" width="696" height="44" rx="6" fill="#f5f5f5" stroke="#e0e0e0" stroke-width="0.8"/>

  <text x="360" y="346" text-anchor="middle" font-size="8" fill="#616161">
    <tspan font-weight="600">Value encoding:</tspan>
    <tspan class="mono" dx="6">0x00</tspan> undefined
    <tspan dx="8" class="mono">0x01</tspan> INT64
    <tspan dx="8" class="mono">0x02</tspan> FLOAT64
    <tspan dx="8" class="mono">0x03</tspan> TEXT
    <tspan dx="8" class="mono">0x04</tspan> BLOB
    <tspan dx="8" class="mono">0x05</tspan> NULL
  </text>

  <text x="360" y="362" text-anchor="middle" font-size="8" fill="#9e9e9e">
    Changeset stores ALL old values (reversible) | Patchset stores PK-only old values (compact, ~23% smaller)
  </text>
</svg>
